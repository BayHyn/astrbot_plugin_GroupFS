# GroupFS for AstrBot - QQ群文件管理插件

![License](https://img.shields.io/badge/license-MIT-green)
![Python](https://img.shields.io/badge/python-3.10+-blue.svg)
![AstrBot](https://img.shields.io/badge/framework-AstrBot-orange)

一款为 [AstrBot](https://github.com/he0119/AstrBot) 设计的强大QQ群文件管理插件，旨在简化和自动化群组的文件维护工作，并提供智能监控预警。

## ✨ 功能特色

### ✓ 已实现功能

* **文件搜索**:
  
  * 使用 `/sf <文件名>` 指令，任何群成员都可以方便地搜索文件。
  * 结果会以带序号的列表展示，包含文件名、上传者、大小和修改时间等详细信息。
* **文件预览**:
  
  * 使用 `/sf <文件名> <序号>` 指令，可预览 `.txt`, `.md`, `.json` 及各类代码文件的部分内容。
  * 可智能识别已失效的文件并提示用户进行清理。
  * 预览的文本长度可在配置文件中自定义。
* **精准文件删除**:
  
  * 使用 `/df <文件名> [序号]` 指令，授权管理员可以删除文件。
  * 若搜索到多个同名文件，会返回列表并要求提供序号，防止误删。
* **群容量自动监控**:
  
  * 可在配置文件中为指定群组设置“文件数量”和“已用空间”的上限阈值。
  * 当有成员上传文件后，插件会自动检测，一旦任一指标达到或超过阈值，会立即在群内发送警告通知。

### 🚀 规划中功能 (Future Plans)

* **失效文件扫描指令**:
  
  * 新增一个手动指令，用于主动扫描整个群的所有文件，并生成一份详细的失效文件报告。
* **重复文件检测**:
  
  * 智能分析文件内容（例如通过 Hash 校验），找出群内重复上传的文件，并提供清理建议，有效节省宝贵的群空间。

## 💿 安装与依赖

1. **安装插件**: 下载本插件的完整文件夹 `astrbot_plugin_groupfs`，并将其放入 AstrBot 的 `data/plugins/` 目录下。
2. **安装依赖库**: 本插件需要 `aiohttp` 和 `chardet` 库。请在您的机器人运行环境中执行：
   
   ```bash
   pip install aiohttp chardet
   ```
3. **重启机器人**: **彻底重启**您的 AstrBot 主程序（例如使用 `docker restart`），以确保插件和依赖被正确加载。

## ⚙️ 配置

插件的配置项定义在 `_conf_schema.json` 文件中，您可以在 AstrBot 的管理后台方便地进行图形化配置。

| 配置项              | 类型     | 描述                                                                                                               |
| :------------------ | :------- | :----------------------------------------------------------------------------------------------------------------- |
| `group_whitelist` | `list` | **群组白名单**。插件指令只在列表中的群组生效。若留空，则对所有群组生效。                                     |
| `admin_users`     | `list` | **管理员QQ列表**。只有在此列表中的用户才有权使用 `/df` 等管理指令。**为了安全，强烈建议配置此项！**  |
| `preview_length`  | `int`  | **文本预览长度**。使用 `/sf ... <序号>` 指令时，显示的内容预览的最大字符数。默认为 300。                   |
| `storage_limits`  | `list` | **群文件容量监控阈值**。格式为 `"群号:文件数量上限:空间上限GB"` 的字符串列表，例如 `"123456:1000:9.5"`。 |

## 📖 使用方法

确保机器人在目标群组拥有**管理员权限**，否则它无法获取文件列表或执行删除操作。

### 搜索与预览

* **搜索文件**: `/sf 文件关键词`
  
  * > `/sf 活着`
* **预览文件**: `/sf 文件关键词 序号`
  
  * > `/sf 活着 1`

### 删除文件 (仅限管理员)

* **删除文件**: `/df 文件关键词 [序号]`
  * 如果只找到一个结果：> `/df 雪山`
  * 如果找到多个结果，根据返回的列表指定序号：> `/df 雪山 2`

### 容量监控

* 此功能为**被动触发**。您只需在配置文件中设置好 `storage_limits`，当有成员上传文件且容量达到阈值时，机器人会自动在群内发送警告。

## 更新日志

* **v0.4** - 新增 **群文件容量监控** 功能，可在文件上传后自动检测容量与数量，并在达到阈值时发送提醒。
* **v0.3** - 新增 **文本文件预览** 功能，可通过 `/sf ... <序号>` 指令查看多种格式的文本文件内容，并能识别失效文件。
* **v0.2** - 新增 **独立的文件搜索指令 (`/sf`)**；同时优化删除指令 (`/df`)，支持在返回多个结果时，通过指定序号进行**精准删除**。
* **v0.1** - 初步实现 **基础的文件删除** 功能，允许管理员通过 `/df <文件名>` 指令管理群文件。
## ❤️ 支持
*  [AstrBot 帮助文档](https://astrbot.app)
* 如果您在使用中遇到问题，欢迎在本仓库提交 [Issue](https://github.com/Foolllll-J/astrbot_plugin_GroupFS/issues)。

